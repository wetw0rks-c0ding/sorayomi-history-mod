# Build Failure Fix

## Problem Summary

The iOS build is failing because the project is missing generated files that are required for compilation. These files are:
- `.g.dart` files (generated by Riverpod and JSON serialization)
- `.freezed.dart` files (generated by Freezed for immutable data classes)
- `__generated__` directories with GraphQL schema files

## Why This Happened

These generated files are **intentionally excluded** from the repository via `.gitignore`:
```
*.g.dart
*.freezed.dart
*.graphql.dart
**/__generated__
```

This is standard practice for Flutter projects using code generation - the generated files are created during the build process rather than being stored in version control.

## Solution

### Option 1: Build Locally (Requires Flutter SDK)

1. **Install Flutter** if not already installed:
   - Download from: https://flutter.dev/docs/get-started/install
   - Add to PATH: `set PATH=%PATH%;C:\path\to\flutter\bin`

2. **Run the build script**:
   ```
   build_windows.bat
   ```

   Or manually run these commands:
   ```bash
   flutter clean
   flutter pub get
   flutter pub run build_runner build --delete-conflicting-outputs
   flutter build ios --release --no-codesign
   ```

### Option 2: Build Using CodeMagic (Recommended for iOS)

1. The `codemagic.yaml` file has been updated with the correct Flutter build configuration
2. Push the changes to your GitHub repository
3. Trigger a build on CodeMagic
4. The build will automatically:
   - Install Flutter dependencies
   - Run code generation
   - Build the iOS app

### Option 3: Pre-generate Files for Local Xcode Build

If you want to open the project in Xcode directly:

1. Run code generation:
   ```bash
   flutter pub get
   flutter pub run build_runner build --delete-conflicting-outputs
   ```

2. Open `ios/Runner.xcworkspace` in Xcode

3. Build and archive from Xcode

## What Was Fixed

1. **Updated `codemagic.yaml`**: Replaced the incorrect AudiobookARR configuration with proper Flutter build steps that include code generation
2. **Created `build_windows.bat`**: A convenience script to run all necessary build steps locally
3. **Note on `l10n.yaml` warning**: The warning about "synthetic-package" (line 490 in build log) is just a deprecation notice and doesn't affect the build

## Build Warnings (Non-Critical)

The build log shows many deprecation warnings from third-party packages (permission_handler, file_picker, etc.). These are:
- Related to iOS API deprecations in newer iOS versions
- From external dependencies, not your code
- Don't prevent the build from succeeding

## Next Steps

For iOS distribution:
1. **Development builds**: Use `--no-codesign` flag (app will be unsigned)
2. **Ad Hoc distribution**: Requires Apple Developer account ($99/year)
3. **TestFlight**: Requires Apple Developer account and app approval

For local testing on iOS devices, consider using:
- **AltStore**: Free method to sideload apps
- **Sideloadly**: Another free sideloading tool
- **Xcode**: Direct installation (requires Mac)

## Technical Details

The project uses these code generators:
- **build_runner**: Orchestrates code generation
- **riverpod_generator**: Generates providers (.g.dart files)
- **freezed**: Generates immutable data classes (.freezed.dart files)
- **graphql_codegen**: Generates GraphQL schema and query files (__generated__ directories)
- **json_serializable**: Generates JSON serialization code (.g.dart files)

All these generators are run with a single command:
```bash
flutter pub run build_runner build --delete-conflicting-outputs
```

The `--delete-conflicting-outputs` flag ensures old generated files are cleaned up before generating new ones.
